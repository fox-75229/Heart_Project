{% extends "base.html" %}

{% block title %}職能發展學院-決策樹{% endblock %}

{% block head %}
{{super()}}
<link rel="stylesheet" href="{{ url_for('static', filename='css/decision_tree.css') }}">
{% endblock %}

{% block content %}
<div class="logistic-container">
    <div class="page-header">
        <h1>決策樹 (Decision Tree)</h1>
        <p class="subtitle">使用心臟衰竭資料集進行心臟病預測 </p>
    </div>

    <div class="info-card">
        <h3>關於決策樹</h3>
        <p>
            決策樹 (Decision Tree) 是一種直觀的機器學習模型，它模仿人類做決策的過程。
        </p>
        <p>
            它會學習一系列的「是/否」問題（例如：`ST 段斜率` > 1.5 嗎？ `運動是否誘發心絞痛` == 1 嗎？），並像**流程圖**一樣將資料層層分類。
        </p>
        <p class="highlight">
            🎯 <strong>提示</strong>：下方圖表將**動態生成**此模型（基於 `ST 段斜率` 和 `運動是否誘發心絞痛`）的「**思考流程圖**」。
        </p>
    </div>

    <div class="tree-legend">
        <h4>圖例說明</h4>
        <div class="legend-grid">
            <div class="legend-item">
                <span class="legend-box color-class-0"></span>
                <span>主要類別為「無心臟病」</span>
            </div>
            <div class="legend-item">
                <span class="legend-box color-class-1"></span>
                <span>主要類別為「有心臟病」</span>
            </div>
        </div>
        <ul class="legend-text">
            <li><strong>samples:</strong> 進入此節點的樣本總數。</li>
            <li><strong>value = [A, B]:</strong> [ A = 無心臟病樣本數, B = 有心臟病樣本數 ]</li>
            <li><strong>class:</strong> 此節點的最終預測 (多數決)。</li>
        </ul>
    </div>


    <div class="control-panel">
        <div class="control-header">
            <h4>調整ST段斜率及運動是否誘發心絞痛預測結果</h4>
        </div>
        <div class="st-control">
            <label for="st-slider">心電圖中ST段斜率：</label>
            <input type="range" id="st-slider" min="0" max="2" value="1" class="slider">
            <span id="st-value" class="value-display">1</span>
        </div>

        <div class="angina-control">
            <span class="angina-label-text">運動是否誘發心絞痛：</span>
            <div class="radio-options-container">
                <div class="radio-option">
                    <label for="angina-yes">YES</label>
                    <input type="radio" id="angina-yes" name="angina_group" value="1">
                </div>
                <div class="radio-option">
                    <label for="angina-no">NO</label>
                    <input type="radio" id="angina-no" name="angina_group" value="0" checked>
                </div>
            </div>
        </div>

        <div class="predict-action">
            <button id="predict-btn" class="cta-button">
                <i class="fas fa-play"></i> 執行預測
            </button>
            <div id="predict-loading" class="loading-spinner-small" style="display: none;"></div>
        </div>

    </div>

    <div id="predict-container" class="predict-container" style="display: none;">
        <div class="predict-text">
            <p>
                經過預測:本案例屬於:
                <strong id="predict-risk-level" class="deg"></strong>
                風險族群
                <strong id="predict-suggestion" class="sug"></strong>
            </p>
        </div>
    </div>

    <div class="tree-container">
        <h3>決策樹模型</h3>
        <div id="graphviz-chart" class="loading">
            <div class="loading-spinner"></div>
            <p class="loading-text">正在從伺服器載入並產生「樹狀圖」...</p>
        </div>
    </div>

    <div class="metrics-container">
        <h3>模型評估指標</h3>
        <div class="metrics-grid">
            <div class="metrics-card">
                <h4>準確率</h4>
                <div id="metrics-accuracy" class="metric-value">--</div>
                <div class="metric-description">模型預測正確的比例</div>
            </div>
            <div class="metrics-card">
                <h4>精確率</h4>
                <div id="metrics-precision" class="metric-value">--</div>
                <div class="metric-description">預測為正樣本中實際為正的比例</div>
            </div>
            <div class="metrics-card">
                <h4>召回率</h4>
                <div id="metrics-recall" class="metric-value">--</div>
                <div class="metric-description">實際正樣本中被正確預測的比例</div>
            </div>
            <div class="metrics-card">
                <h4>F1 Score</h4>
                <div id="metrics-f1" class="metric-value">--</div>
                <div class="metric-description">精確率與召回率的綜合表現</div>
            </div>
            <div class="metrics-card">
                <h4>AUC 值</h4>
                <div id="metrics-auc" class="metric-value">--</div>
                <div class="metric-description">ROC 曲線下的面積，越大越好</div>
            </div>
        </div>
    </div>

    <div class="model-info">
        <h3>模型詳細資訊</h3>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">資料集：</span>
                <span class="info-value" id="desc-dataset">--</span>
            </div>
            <div class="info-item">
                <span class="info-label">總樣本數：</span>
                <span class="info-value" id="desc-total-samples">--</span>
            </div>
            <div class="info-item">
                <span class="info-label">訓練集大小：</span>
                <span class="info-value" id="desc-train-size">--</span>
            </div>
            <div class="info-item">
                <span class="info-label">測試集大小：</span>
                <span class="info-value" id="desc-test-size">--</span>
            </div>
            <div class="info-item">
                <span class="info-label">預測目標：</span>
                <span class="info-value" id="desc-target">--</span>
            </div>
            <div class="info-item">
                <span class="info-label">使用特徵：</span>
                <span class="info-value" id="desc-features">--</span>
            </div>
        </div>
    </div>

</div> {% endblock %}


{% block scripts %}
{{super()}}
<script src="{{ url_for('static', filename='js/decision_tree.js') }}"></script>
{% endblock %}